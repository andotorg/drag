/**
 * HTML DOM DRAGGABLE
 * @date   2016-03-20
 * @author ganzwen@gmail.com
 * @site   https://github.com/baixuexiyang/drag.git
 */
!function(name,fun){"undefined"!=typeof module&&module.exports?module.exports=fun():"function"==typeof define&&define.amd?define(fun):this[name]=fun()}("Drag",function(){"use strict";var isIE=/msie/.test(navigator.userAgent.toLowerCase()),Bind=function(object,fun){return function(){return fun.apply(object,arguments)}},Css=function(element,styles){for(var _k in styles)element.style[_k]=styles[_k];return element},BindAsEventListener=function(object,fun){return function(event){return fun.call(object,event||window.event)}},CurrentStyle=function(element){return element.currentStyle||document.defaultView.getComputedStyle(element,null)},addEventHandler=function(oTarget,sEventType,fnHandler){oTarget.addEventListener?oTarget.addEventListener(sEventType,fnHandler,!1):oTarget.attachEvent?oTarget.attachEvent("on"+sEventType,fnHandler):oTarget["on"+sEventType]=fnHandler},removeEventHandler=function(oTarget,sEventType,fnHandler){oTarget.removeEventListener?oTarget.removeEventListener(sEventType,fnHandler,!1):oTarget.detachEvent?oTarget.detachEvent("on"+sEventType,fnHandler):oTarget["on"+sEventType]=null},Drag=function(drag,options){this.Drag=document.getElementById(drag),this._x=this._y=0,this._marginLeft=this._marginTop=0,this._fM=BindAsEventListener(this,this.Move),this._fS=Bind(this,this.Stop),this.SetOptions(options),this.Limit=!!this.options.Limit,this.minLeft=parseInt(this.options.minLeft),this.minRight=parseInt(this.options.minRight),this.minTop=parseInt(this.options.minTop),this.minBottom=parseInt(this.options.minBottom),this.onlyY=!!this.options.onlyY,this.onlyX=!!this.options.onlyX,this.isLock=!!this.options.isLock,this.onStart=this.options.onStart,this.onMove=this.options.onMove,this.onStop=this.options.onStop,this._Handler=document.getElementById(this.options.targets)||this.Drag,this._container=document.getElementById(this.options.container)||null,this._container&&Css(this._container,{position:"relative",overflow:"hidden"}),this.Drag&&Css(this.Drag,{position:"absolute",top:0,left:0,cursor:"move"}),isIE&&this.options.Transparent&&this._Handler.appendChild(Css(document.createElement("div"),{width:"100%",height:"100%",backgroundColor:"#fff",filter:"alpha(opacity:0)",fontSize:0})),this.Repair(),addEventHandler(this._Handler,"mousedown",BindAsEventListener(this,this.Start))};return Drag.prototype={SetOptions:function(options){options=options||{},this.options={targets:"",Limit:!1,minLeft:0,minRight:99999,minTop:0,minBottom:99999,container:"",onlyY:!1,onlyX:!1,isLock:!1,Transparent:!0,onStart:function(){},onMove:function(){},onStop:function(){}};for(var _k in options)this.options[_k]=options[_k]},setLock:function(){this.isLock=!0},releaseLock:function(){this.isLock=!1},getPositions:function(){return{left:this.Drag.offsetLeft,top:this.Drag.offsetTop}},Start:function(oEvent){this.isLock||(this.Repair(),this._x=oEvent.clientX-this.Drag.offsetLeft,this._y=oEvent.clientY-this.Drag.offsetTop,this._marginLeft=parseInt(CurrentStyle(this.Drag).marginLeft)||0,this._marginTop=parseInt(CurrentStyle(this.Drag).marginTop)||0,addEventHandler(document,"mousemove",this._fM),addEventHandler(document,"mouseup",this._fS),isIE?(addEventHandler(this._Handler,"losecapture",this._fS),this._Handler.setCapture()):(addEventHandler(window,"blur",this._fS),oEvent.preventDefault()),this.onStart())},Repair:function(){this.Limit&&(this.minRight=Math.max(this.minRight,this.minLeft+this.Drag.offsetWidth),this.minBottom=Math.max(this.minBottom,this.minTop+this.Drag.offsetHeight),!this._container||"relative"==CurrentStyle(this._container).position||"absolute"==CurrentStyle(this._container).position||(this._container.style.position="relative"))},Move:function(oEvent){if(this.isLock)return void this.Stop();window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();var iLeft=oEvent.clientX-this._x,iTop=oEvent.clientY-this._y;if(this.Limit){var minLeft=this.minLeft,minRight=this.minRight,minTop=this.minTop,minBottom=this.minBottom;this._container&&(minLeft=Math.max(minLeft,0),minTop=Math.max(minTop,0),minRight=Math.min(minRight,this._container.clientWidth),minBottom=Math.min(minBottom,this._container.clientHeight)),iLeft=Math.max(Math.min(iLeft,minRight-this.Drag.offsetWidth),minLeft),iTop=Math.max(Math.min(iTop,minBottom-this.Drag.offsetHeight),minTop)}this.onlyY||(this.Drag.style.left=iLeft-this._marginLeft+"px"),this.onlyX||(this.Drag.style.top=iTop-this._marginTop+"px"),this.onMove()},Stop:function(){removeEventHandler(document,"mousemove",this._fM),removeEventHandler(document,"mouseup",this._fS),isIE?(removeEventHandler(this._Handler,"losecapture",this._fS),this._Handler.releaseCapture()):removeEventHandler(window,"blur",this._fS),this.onStop()}},Drag});
